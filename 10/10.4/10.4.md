# 10.4. Flujo de Operaciones
## Módulo 3
### Proceso batch 1:
1. **Inicio**
2. Obtener todas las vacantes
3. Iterar sobre cada vacante
   - Si la fecha fin es menor a la fecha actual:
     - Si el estado es "Abierta":
       - Actualizar estado a "Cerrada"
       - Guardar vacante actualizada
4. **Fin**
### Proceso batch 2:
1. **Inicio**
2. Obtener todas las convocatorias
3. Iterar sobre cada convocatoria
   - Si la fecha fin es menor a la fecha actual:
     - Si el estado no es "cerrada":
       - Actualizar estado a "cerrada"
       - Guardar convocatoria actualizada
4. **Fin**

## Módulo 4

### Proceso batch 1: Reporte business

1. **Preparación de Tablas**  
   - Se crean o verifican las tablas necesarias para almacenar los datos del reporte, como:
     - `reporte_tiempo_resolucion_etiqueta`
     - `reporte_tipificacion_general`
     - `reporte_tipificacion_detallado`
     - `reporte_volumen_tickets`
     - `reporte_clientes_activos`
     - `reporte_tickets_empleado`

2. **Limpieza de Datos**  
   - Se eliminan los datos existentes en las tablas para evitar duplicados o inconsistencias en la generación del nuevo reporte.

3. **Extracción y Cálculo de Métricas**  
   - A partir de las tablas base (`conversacion`, `Ticket_asig_tip`, `Estado_ticket_asig`, etc.), se calculan métricas específicas para cada reporte:
     - **Promedio de Tiempo de Resolución por Etiqueta**: Calculado en horas a partir de la diferencia entre la fecha de inicio y fin.
     - **Volumen General y Detallado de Tipificación**: Contabilización de tickets asignados según diferentes criterios (categoría, funcionalidad, motivo, tipología).
     - **Volumen de Tickets Atendidos**: Total de tickets resueltos en el período.
     - **Clientes Más Activos**: Identificación de empresas con mayor número de clientes recurrentes.
     - **Tickets Gestionados por Empleado**: Total de tickets resueltos por cada empleado.

4. **Agrupación por Período**  
   - Los datos se clasifican según el período especificado (`mes`, `trimestre`, `semestre` o `año`) para organizar la información según el marco temporal definido.

5. **Carga en Tablas de Reportes**  
   - Los resultados calculados se insertan en las tablas correspondientes, preparándolas para su consulta o análisis posterior.

### Proceso batch 2: Reporte analista
1. **Preparación de Tablas**  
   - Se crean o verifican tablas temporales para almacenar datos específicos de analistas, tales como:
     - `tmp_reporte_modificaciones`
     - `tmp_reporte_sugerencias_correcciones`
     - `tmp_reporte_tasa_adopcion`
     - `tmp_reporte_problemas_recurrentes`
     - `tmp_reporte_uso_etiquetas`
     - `tmp_reporte_reasignaciones`

2. **Limpieza de Datos**  
   - Se eliminan los datos temporales existentes para garantizar que el reporte refleje únicamente la información del período en curso.

3. **Extracción y Cálculo de Métricas**  
   - A partir de las tablas base (`historial_asignacion`, `tipificacion`, `Ticket_asig_tip`, etc.), se derivan los siguientes indicadores:
     - **Frecuencia de Modificaciones**: Cantidad de acciones como asignaciones o ediciones realizadas por cada analista.
     - **Cantidad de Sugerencias y Correcciones**: Total de propuestas y ajustes registrados.
     - **Tasa de Adopción de Sugerencias**: Porcentaje de sugerencias implementadas respecto al total propuesto.
     - **Problemas Recurrentes**: Categorías, funcionalidades, motivos y tipologías con mayor frecuencia en el período.
     - **Uso de Etiquetas**: Número de veces que cada etiqueta fue utilizada.
     - **Reasignaciones de Tickets**: Frecuencia de reasignaciones para cada ticket.

4. **Agrupación por Período**  
   - Al igual que en el reporte Business, las métricas se clasifican por períodos (`mes`, `trimestre`, `semestre` o `año`).

5. **Carga en Tablas Temporales**  
   - Los datos calculados se insertan en las tablas temporales para facilitar el análisis y la generación de reportes personalizados.
     
## **Flujo General del Proceso Batch**

1. **Inicia el proceso**  
   - Se invocan las **procedures** correspondientes (`reporte_business` y `reporte_analista`) con los parámetros de año y período.

2. **Ejecución Secuencial**  
   - Primero, se ejecuta el cálculo del **reporte Business**, seguido del cálculo del **reporte Analista**.

3. **Consolidación de Datos**  
   - Los datos generados se organizan en tablas permanentes (para reporte Business) o temporales (para reporte Analista) para su análisis o visualización.

4. **Finalización**  
   - El proceso termina cuando todas las tablas han sido llenadas con la información procesada.
