# 8.1. Sentencias SQL por módulo / prototipo

## Módulo de Gestión de Promociones

Código Requerimiento: P-001

Código Interfaz: PI-001

Sentencias SQL:
'''

'''


## Modulo de Campañas Publicitarias


#### Código Requerimiento: CP-001<br> 

#### Código Interfaz: ICP-001<br>

Imagen Interfaz.      
![image](https://github.com/user-attachments/assets/214e7a9e-1995-43a3-a028-daf8d9c25079)

#### Código Interfaz: ICP-002<br>

Imagen Interfaz.
![image](https://github.com/user-attachments/assets/ef209b56-c804-41f6-a8cf-709bd0bec374)

#### Código Interfaz: ICP-003<br>

Imagen Interfaz.
![image](https://github.com/user-attachments/assets/b35edb9e-b452-462d-a492-56f75ca0e778)

### Sentencias SQL
```sql
--1er Trigger para la Seleccion automatica de un espacio especifico para los archivos que suba el usuario creador de prototipo
CREATE OR REPLACE FUNCTION insert_null_resources()
RETURNS TRIGGER AS $$
BEGIN
    -- Insertar recursos con valores NULL para el nuevo prototipo
    INSERT INTO Recursos (nombre_recurso, url_recurso, id_tipo_recurso, cod_prototipo)
    VALUES 
        (NULL, NULL, (SELECT id_tipo_recurso FROM Tipo_recurso WHERE nombre_tipo = 'Foto'), NEW.cod_prototipo),
        (NULL, NULL, (SELECT id_tipo_recurso FROM Tipo_recurso WHERE nombre_tipo = 'Video'), NEW.cod_prototipo),
        (NULL, NULL, (SELECT id_tipo_recurso FROM Tipo_recurso WHERE nombre_tipo = 'Guion'), NEW.cod_prototipo),
        (NULL, NULL, (SELECT id_tipo_recurso FROM Tipo_recurso WHERE nombre_tipo = 'Documento'), NEW.cod_prototipo);
        
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

--Crear el trigger
CREATE TRIGGER after_insert_prototipo
AFTER INSERT ON Prototipo
FOR EACH ROW
EXECUTE FUNCTION insert_null_resources();

--2do Trigger para la creacion automatica del id_audiencia 
--Primera funcion es para tener las iniciales de la ubicacion
CREATE OR REPLACE FUNCTION generate_initials(location VARCHAR)
RETURNS VARCHAR AS $$
DECLARE
    initials VARCHAR := '';
    word VARCHAR;
BEGIN
    -- Dividir la ubicación en palabras y construir las siglas
    FOR word IN SELECT unnest(string_to_array(location, ' ')) LOOP
        initials := initials || LEFT(word, 1); -- Agregar la primera letra de cada palabra
    END LOOP;

    RETURN initials;
END;
$$ LANGUAGE plpgsql;

--Segunda funcion para la creacion automatica de los id_audiencia utilizando la funcion anterior
CREATE OR REPLACE FUNCTION generate_id_audiencia()
RETURNS TRIGGER AS $$
BEGIN
    NEW.id_audiencia := CONCAT(
        SUBSTRING(NEW.Edad_rango FROM 1 FOR 2), -- Min Edad
        SUBSTRING(NEW.Edad_rango FROM 4 FOR 2), -- Max Edad
        NEW.Genero,
        generate_initials(NEW.Ubicacion) -- Usar la función para obtener las siglas
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trg_generate_id_audiencia ON Audiencia;

CREATE TRIGGER trg_generate_id_audiencia
BEFORE INSERT ON Audiencia
FOR EACH ROW
EXECUTE FUNCTION generate_id_audiencia();
```
#### Boton siguiente:
Este boton redirecciona a la interfaz ICP-002 <br>
#### Boton guardar:
Con este boton inicia la insercion de todos los datos colocados por el usuario y lo redirecciona al ICP-003. <br>
```sql
--Ejemplo insercion de datos
INSERT INTO Audiencia (Edad_rango, Genero, Ubicacion)
VALUES 
('25-35','F','San Juan de Lurigancho');
INSERT INTO Prototipo (nombre_prot, Descripcion, Prop_presupuesto, Fecha_creacion, Prop_audiencia, ID_empleado)
VALUES 
('Estrategia de Expansión de Mercado','Prototipo para evaluar la aceptación de un nuevo servicio en mercados jóvenes urbanos',7500.00,'2024-10-25 10:45:00','2535FL', 5);
INSERT INTO Objetivos (Descripcion, cod_prototipo)
VALUES
('Aumentar la visibilidad en el segmento de mujeres jóvenes en Lima', 5),
('Incrementar el número de clientes potenciales en un 15%', 5);  
INSERT INTO prototipoxcanal (cod_prototipo, cod_canal)
VALUES
(5, 1);

UPDATE Recursos
SET url_recurso = CASE 
    WHEN id_tipo_recurso = (SELECT id_tipo_recurso FROM Tipo_recurso WHERE nombre_tipo = 'Foto') THEN 'http://example.com/foto'
    ELSE url_recurso -- Mantiene el valor actual si no es ninguno de los tipos mencionados
END
WHERE cod_prototipo = 5;


```

## Módulo de Gestión Integral de Reclutamiento y Selección
1. Código requerimiento: M-001
Interfaces:
1. Código: MI-001
![image](https://github.com/user-attachments/assets/28fbbd31-0548-445f-93b3-3cfbb55b16ee)
2. Código: MI-002
![image](https://github.com/user-attachments/assets/19f0511c-5941-45ec-ab94-5baa761580a6)
3. Código: MI-003
![image](https://github.com/user-attachments/assets/35924d98-df9b-4793-a54b-4efc87f5d188)

```sql
Sentencias:
1. Todas las vacantes:
SELECT v.*, p.nombre AS nombre_puesto
FROM Vacante v
JOIN Puesto p ON v.id_puesto = p.id_puesto;
2. Filtro de vacantes:
SELECT v.*, p.nombre AS nombre_puesto
FROM Vacante v
JOIN Puesto p ON v.id_puesto = p.id_puesto
WHERE v.estado = 'Abierta';
3. Edición de una vacante
UPDATE Vacante
SET nombre = 'Nuevo Nombre', descripcion = 'Nueva Descripción', salario = 50000
WHERE id_vacante = 1;
```

### 2. Código requerimiento: M-002
Interfaces:
1. Código: MI-004
![image](https://github.com/user-attachments/assets/f7aa3253-f9fc-4fca-9118-c5f4fc294271)

```sql
Sentencias:
1. INSERT INTO Vacante (id_puesto, descripcion, fecha_publicacion, estado)
VALUES (1, 'Descripción de la vacante', '2024-01-01', 'Abierta');
```

### 3. Código requerimiento: M-003
Interfaces:
1. Código: MI-005
![image](https://github.com/user-attachments/assets/879c6b56-34ea-4ef2-b5fa-07a2a90fcd8c)

```sql
Sentencias:
1. Eliminar una vacante y tablas que poseen su id
-- Eliminar convocatorias relacionadas con la vacante
DELETE FROM Convocatoria
WHERE id_vacante = 1;

-- Eliminar postulantes relacionados con la vacante
DELETE FROM Postulante
WHERE id_vacante = 1;

-- Eliminar ofertas laborales relacionadas con la vacante
DELETE FROM Oferta_Laboral
WHERE id_vacante = 1;

-- Eliminar la vacante
DELETE FROM Vacante
WHERE id_vacante = 1;
```

### 4. Código requerimiento: M-004
Interfaces:
1. Código: MI-006
![image](https://github.com/user-attachments/assets/858a6a73-fb1a-48ef-be6b-1bd7935ca732)
2. Código: MI-007
![image](https://github.com/user-attachments/assets/8fb969a4-e18a-4906-92e7-ef75f1430e07)

```sql
Sentencias:
1. Eliminar un postulante y sus tablas asociadas por id
-- Eliminar registros de Observacion relacionados con las entrevistas del postulante
DELETE FROM Observacion
WHERE id_entrevista IN (SELECT id_entrevista FROM Entrevista WHERE id_postulante = <id_postulante>);

-- Eliminar registros de Entrevista relacionados con el postulante
DELETE FROM Entrevista
WHERE id_postulante = <id_postulante>;

-- Eliminar registros de Oferta_Laboral_Beneficio relacionados con el postulante
DELETE FROM Oferta_Laboral_Beneficio
WHERE id_oferta IN (SELECT id_oferta FROM Oferta_Laboral WHERE id_postulante = <id_postulante>);

-- Eliminar registros de Oferta_Laboral relacionados con el postulante
DELETE FROM Oferta_Laboral
WHERE id_postulante = <id_postulante>;

-- Eliminar registros de Habilidad_Postulante relacionados con el postulante
DELETE FROM Habilidad_Postulante
WHERE id_postulante = <id_postulante>;

-- Eliminar registros de Idioma_Postulante relacionados con el postulante
DELETE FROM Idioma_Postulante
WHERE id_postulante = <id_postulante>;

-- Eliminar registros de Habilidad_Experiencia relacionados con las experiencias laborales del postulante
DELETE FROM Habilidad_Experiencia
WHERE id_experiencia IN (SELECT id_experiencia FROM Experiencia_Laboral WHERE id_postulante = <id_postulante>);

-- Eliminar registros de Experiencia_Laboral relacionados con el postulante
DELETE FROM Experiencia_Laboral
WHERE id_postulante = <id_postulante>;

-- Eliminar registros de Educacion relacionados con el postulante
DELETE FROM Educacion
WHERE id_postulante = <id_postulante>;

-- Eliminar el postulante
DELETE FROM Postulante
WHERE id_postulante = <id_postulante>;
```

### 5. Código requerimiento: M-005
Interfaces:
1. Código: MI-008
![image](https://github.com/user-attachments/assets/8bf3ad69-2fc5-4388-926d-ba878d3f428e)

```sql
Sentencias:
1. Crear un postulante y todas las entidades conectadas a él por su id
-- Insert into Postulante
INSERT INTO Postulante (id_postulante, nombre, apellido, email, telefono, direccion, fecha_nacimiento, genero, estado_civil, nacionalidad)
VALUES (101, 'John', 'Doe', 'john.doe@example.com', '1234567890', '123 Main St', '1990-01-01', 'M', 'Soltero', 'USA');

-- Insert into Idioma_Postulante
INSERT INTO Idioma_Postulante (id_postulante, id_idioma, nivel)
VALUES (101, 1, 'Intermedio'), (101, 2, 'Avanzado');

-- Insert into Habilidad_Postulante
INSERT INTO Habilidad_Postulante (id_postulante, nombre, nivel)
VALUES (101, 'Java Programming', 'Avanzado'), (101, 'SQL', 'Intermedio');

-- Insert into Oferta_Laboral
INSERT INTO Oferta_Laboral (id_postulante, id_vacante, fecha_oferta, fecha_inicio_propuesta, link_documento_legal_sin_firma, link_documento_legal_con_firma, estado)
VALUES (101, 1, '2024-01-01', '2024-02-01', 'link101_sin_firma', 'link101_con_firma', 'Pendiente');

-- Insert into Entrevista
INSERT INTO Entrevista (estado, fecha, puntaje_general, id_postulante, ID_empleado, tipo_entrevista)
VALUES ('Pendiente', '2024-01-15', 85, 101, 1, 'Inicial');

-- Insert into Observacion
INSERT INTO Observacion (id_entrevista, nombre, descripcion)
VALUES (1, 'Observation 101', 'The candidate showed strong analytical skills.');
```

### 6. Código requerimiento: M-006
Interfaces:
1. Código: MI-009
![image](https://github.com/user-attachments/assets/de4fa0ce-2aad-4025-814b-bf183fd620cb)

```sql
Sentencias:
1. Actualizar información de un postulante y todas las tablas asociadas a él
-- Actualizar información del postulante
UPDATE Postulante
SET nombre = 'Nuevo Nombre', apellido = 'Nuevo Apellido', email = 'nuevoemail@example.com'
WHERE id_postulante = 1;

-- Actualizar habilidades del postulante
UPDATE Habilidad_Postulante
SET nivel = 'Avanzado'
WHERE id_postulante = 1 AND nombre = 'Project Management';

-- Actualizar idiomas del postulante
UPDATE Idioma_Postulante
SET nivel = 'Avanzado'
WHERE id_postulante = 1 AND id_idioma = 1;

-- Actualizar ofertas laborales del postulante
UPDATE Oferta_Laboral
SET estado = 'Aceptada'
WHERE id_postulante = 1 AND id_vacante = 1;

-- Actualizar entrevistas del postulante
UPDATE Entrevista
SET estado = 'Hecha', puntaje_general = 95
WHERE id_postulante = 1 AND ID_empleado = 1;
```

### 7. Código requerimiento: M-007
Interfaces:
1. Código: MI-010
![image](https://github.com/user-attachments/assets/e018889a-8a09-4603-bdd2-ab2d7b32972c)

```sql
Sentencias:
1. Obtener todos los datos asociados al postulante directamente
SELECT p.*, 
       e.*, 
       he.*, 
       i.*, 
       ip.*, 
       hp.*, 
       ol.*, 
       olb.*, 
       ent.*, 
       obs.*
FROM Postulante p
LEFT JOIN Experiencia e ON p.id_postulante = e.id_postulante
LEFT JOIN Habilidad_Experiencia he ON e.id_experiencia = he.id_experiencia
LEFT JOIN Idioma_Postulante ip ON p.id_postulante = ip.id_postulante
LEFT JOIN Idioma i ON ip.id_idioma = i.id_idioma
LEFT JOIN Habilidad_Postulante hp ON p.id_postulante = hp.id_postulante
LEFT JOIN Oferta_Laboral ol ON p.id_postulante = ol.id_postulante
LEFT JOIN Oferta_Laboral_Beneficio olb ON ol.id_oferta = olb.id_oferta
LEFT JOIN Entrevista ent ON p.id_postulante = ent.id_postulante
LEFT JOIN Observacion obs ON ent.id_entrevista = obs.id_entrevista
WHERE p.id_postulante = [ID_POSTULANTE];
2. Formación de feedback
SELECT e.*, o.nombre AS nombre_observacion, o.descripcion AS descripcion_observacion
FROM Entrevista e
LEFT JOIN Observacion o ON e.id_entrevista = o.id_entrevista
WHERE e.id_postulante = [ID_POSTULANTE];
```
### 8. Código requerimiento: M-008
Interfaces:
1. Código: MI-011
![image](https://github.com/user-attachments/assets/d7db406b-0804-4772-ad41-799574624ca4)
2. Código: MI-012
![image](https://github.com/user-attachments/assets/ec3c3be1-d410-430a-860d-eabc5fbcc841)

```sql 
Sentencias:
1. Creación de una entrevista de un postulante
INSERT INTO Entrevista (estado, fecha, puntaje_general, id_postulante, ID_empleado, tipo_entrevista)
VALUES ('Pendiente', '2024-05-01', 0, 101, 1, 'Inicial');
```

### 9.  Código requerimiento: M-009
Interfaces:
1. Código: MI-013
![image](https://github.com/user-attachments/assets/0a2cde1c-5b9f-44da-aedb-c281038111a1)
2. Código: MI-014
![image](https://github.com/user-attachments/assets/6c9ea689-4009-45eb-9a2e-6cf64355fe33)

```sql
Sentencias:
1.Editar una entrevista de un postulante
UPDATE Entrevista
SET estado = 'Hecha',
    fecha = '2024-01-16',
    puntaje_general = 90,
    id_postulante = 2,
    ID_empleado = 2,
    tipo_entrevista = 'HR'
WHERE id_entrevista = 1;
```

### 10. Código requerimiento: M-010
Interfaces:
1. Código: MI-015
![image](https://github.com/user-attachments/assets/892ce9b5-5a6f-4526-8f46-a70723bb5356)

```sql
Sentencias:
1. Eliminar entrevista y los asociados a ella por id
-- Eliminar observaciones asociadas a la entrevista
DELETE FROM Observacion
WHERE id_entrevista = <id_entrevista>;

-- Eliminar la entrevista
DELETE FROM Entrevista
WHERE id_entrevista = <id_entrevista>;

```
### 11. Código requerimiento: M-011
Interfaces:
1. Código: MI-016
![image](https://github.com/user-attachments/assets/d3c530e8-3de1-4ec3-9f88-0041e8666cf6)

```sql
Sentencias:
1. Crear observación a una entrevsita
INSERT INTO Observacion (id_entrevista, nombre, descripcion) 
VALUES (101, 'Observation 101', 'The candidate demonstrated excellent communication skills.');
```

### 12. Código requerimiento: M-012
Interfaces:
1. Código: MI-017
![image](https://github.com/user-attachments/assets/c86c6f3c-ede5-4fda-8797-91f2a243336e)

```sql
Sentencias:
1. Editar una observación
UPDATE Observacion
SET nombre = 'Nuevo nombre', descripcion = 'Nueva descripción'
WHERE id_entrevista = 1;
```

### 13. Código requerimiento: M-013
Interfaces:
1. Código: MI-018
![image](https://github.com/user-attachments/assets/7e5ad77d-5b53-4a6c-afd0-9a2bfc04d433)

```sql
Sentencias:
1. Eliminar una observación
DELETE FROM Observacion
WHERE id_entrevista = 1 AND nombre = 'Observation 1';
```

### 14. Código requerimiento: M-014
Interfaces:
1. Código: MI-019
![image](https://github.com/user-attachments/assets/51ac886a-68b7-459c-a7cc-4ce25461e567)

```sql
Sentencias:
1. Actualizar una oferta laboral
-- Actualizar la oferta laboral
UPDATE Oferta_Laboral
SET fecha_oferta = '2023-12-01',
    fecha_inicio_propuesta = '2024-01-01',
    link_documento_legal_sin_firma = 'nuevo_link_sin_firma',
    link_documento_legal_con_firma = 'nuevo_link_con_firma',
    estado = 'Aceptada'
WHERE id_oferta = 1;

-- Eliminar los beneficios actuales asociados a la oferta laboral
DELETE FROM Oferta_Laboral_Beneficio
WHERE id_oferta = 1;

-- Insertar los nuevos beneficios asociados a la oferta laboral
INSERT INTO Oferta_Laboral_Beneficio (id_oferta, id_beneficio) VALUES
(1, 1),
(1, 2),
(1, 3);
```

### 15. Código requerimiento: M-015
Interfaces:
1. Código: MI-020
![image](https://github.com/user-attachments/assets/4d166085-7eec-40cf-876c-975b1f41e06b)

```sql
Sentencias:
1. Crear nuevo empleado
INSERT INTO Empleado (id_postulante, nombre, apellido, fecha_contratacion, puesto)
SELECT id_postulante, nombre, apellido, CURDATE(), 'Puesto Asignado'
FROM Postulante
WHERE id_postulante = 1;
```

### 16. Código requerimiento: M-016
Interfaces:
1. Código: MI-021
![image](https://github.com/user-attachments/assets/ede0218f-69ba-499c-8794-614c9393b6de)
2. Código: MI-022
![image](https://github.com/user-attachments/assets/74b069dd-36dc-4bbc-aebb-7d86778b5560)

```sql
Sentencias:
1. Organigrama:
SELECT d1.nombre AS departamento, d2.nombre AS departamento_superior
FROM Departamento d1
LEFT JOIN Departamento d2 ON d1.id_departamento_superior = d2.id_departamento;  
2. Puestos por departamento:
SELECT d.nombre AS nombre_departamento, p.nombre AS nombre_puesto
FROM Puesto p
JOIN Departamento d ON p.id_departamento = d.id_departamento
ORDER BY d.nombre, p.nombre;
3. Crear puesto y funciones asociadas por id:
-- Crear el puesto
INSERT INTO Puesto (nombre, descripcion) VALUES ('Nuevo Puesto', 'Descripción del nuevo puesto');

-- Obtener el id del puesto recién creado
SET @id_puesto = LAST_INSERT_ID();

-- Crear las funciones asociadas al puesto
INSERT INTO Funcion (id_puesto, descripcion) VALUES
(@id_puesto, 'Función 1 del nuevo puesto'),
(@id_puesto, 'Función 2 del nuevo puesto'),
(@id_puesto, 'Función 3 del nuevo puesto');
```

### 17. Código requerimiento: M-017
Interfaces:
1. Código: MI-023
![image](https://github.com/user-attachments/assets/e563139c-e813-4cb7-a70f-c78bbeaf4c8b)

```sql
Sentencias:
1. Editar un puesto y sus funciones asociadas
-- Actualizar el puesto
UPDATE Puesto
SET nombre = 'Nuevo Nombre del Puesto', descripcion = 'Nueva Descripción del Puesto'
WHERE id_puesto = 1;

-- Eliminar las funciones asociadas al puesto
DELETE FROM Funcion
WHERE id_puesto = 1;

-- Insertar las nuevas funciones asociadas al puesto
INSERT INTO Funcion (id_puesto, descripcion)
VALUES
(1, 'Nueva Función 1'),
(1, 'Nueva Función 2'),
(1, 'Nueva Función 3');
```

### 18. Código requerimiento: M-018
Interfaces:
1. Código: MI-024
![image](https://github.com/user-attachments/assets/f105b3d5-e190-4867-a951-1e70e1e80e7d)

```sql
Sentencias:
1. Eliminar un puesto
-- Eliminar funciones asociadas al puesto
DELETE FROM Funciones
WHERE id_puesto = <id_puesto>;

-- Eliminar el puesto
DELETE FROM Puesto
WHERE id_puesto = <id_puesto>;
```

### 19. Código requerimiento: M-019
Interfaces:
1. Código: MI-025
![image](https://github.com/user-attachments/assets/0ba4067f-d0b4-4efb-9343-4663daf353c0)

```sql
Sentencias:
1. Eliminar una convocatoria
DELETE FROM Vacante
WHERE id_vacante = <id_de_la_convocatoria>;
```

### 20. Código requerimiento: M-020
Interfaces:
1. Código: MI-026
![image](https://github.com/user-attachments/assets/520b7b9d-bd79-4740-a451-104d5e9d6227)

```sql
Sentencias:
1. Crear una nueva convocatoria
INSERT INTO Convocatoria (id_convocatoria, nombre, descripcion, fecha_inicio, fecha_fin, estado)
VALUES (1, 'Convocatoria de Desarrolladores', 'Buscamos desarrolladores con experiencia en Java y SQL', '2024-01-01', '2024-01-31', 'Abierta');
```

### 21. Código requerimiento: M-021
Interfaces:
1. ![image](https://github.com/user-attachments/assets/28d5d861-5626-4fcb-be3b-0e94c2bf17b7)

```sql
Sentencias:
1. Editar una convocatoria:
UPDATE Vacante
SET nombre = 'Nuevo Nombre', descripcion = 'Nueva Descripción', estado = 'Nuevo Estado'
WHERE id_vacante = 1;
```
